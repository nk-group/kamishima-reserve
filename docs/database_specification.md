# 車検予約管理システム データベース仕様書

**目的:** 上嶋自動車様のデータベース仕様書です。

**環境仕様:**

* **OS:** Windows 11 Pro (24H2 推奨) + WSL2/Ubuntu
* **コンテナ化:** Docker / Docker Compose
* **PHP:** 8.1.x
* **フレームワーク:** CodeIgniter 4.6.x
* **データベース:** MySQL 5.7.x + phpMyAdmin
* **認証:** Shield v1.1.x
* **PDF:** mPDF v8.1.x
* **フロントエンド:** Vite 5.4.x + Flatpickr v4.6.x + SASS
* **エディタ:** VSCode

-----


**1. 予約状況区分 (reserve_statuses)**

  * **日本語テーブル名:** 予約状況区分
  * **物理テーブル名:** `reserve_statuses`
  * **説明:** 予約のさまざまな状態（未確定、予約確定など）を管理します。
  * **特記事項:** メンテナンス画面は無し

**テーブル構造**

| 論理名 (日本語)       | 物理名 (英語)     | データ型            | NOT NULL | PK | FK | UNIQUE | DEFAULT | INDEX | 備考                                                            |
|-----------------------|-------------------|---------------------|----------|----|----|--------|---------|-------|-----------------------------------------------------------------|
| 予約状況ID            | id                | TINYINT(3) UNSIGNED | ○       | ○ |    |        |         |       | 主キー (1:未確定, 2:予約確定, 3:作業完了, 9:キャンセル)         |
| 予約状況コード        | code              | VARCHAR(30)         | ○       |    |    | ○     |         | ○    | プログラム用コード (例: pending, confirmed)                     |
| 予約状況名            | name              | VARCHAR(50)         | ○       |    |    |        |         |       | 例: 未確定, 予約確定                                            |
| 表示順                | sort_order        | INT(5) UNSIGNED     | ○       |    |    |        | 0       |       | 並び順を制御するための数値                                      |

**初期データ**

| 予約状況ID   | 予約状況コード | 予約状況名        | 表示順 | 
|--------------|----------------|-------------------|--------|
| 1            | pending        | 未確定            | 10     |
| 2            | confirmed      | 予約確定          | 20     |
| 3            | completed      | 作業完了          | 30     |
| 9            | canceled       | キャンセル        | 90     |


-----


**2. 作業種別区分 (work_types)**

  * **日本語テーブル名:** 作業種別区分
  * **物理テーブル名:** `work_types`
  * **説明:** 提供する作業の種別（Clear車検、一般整備など）を管理します。
  * **特記事項:** メンテナンス画面は無し

**テーブル構造**

| 論理名 (日本語)       | 物理名 (英語)     | データ型            | NOT NULL | PK | FK | UNIQUE | DEFAULT | INDEX | 備考                                                            |
|-----------------------|-------------------|---------------------|----------|----|----|--------|---------|-------|-----------------------------------------------------------------|
| 作業種別ID            | id                | TINYINT(3) UNSIGNED | ○       | ○ |    |        |         |       | 主キー                                                          |
| 作業種別コード        | code              | VARCHAR(30)         | ○       |    |    | ○     |         | ○    | プログラム用コード (例: clear_shaken)                           |
| 作業種別名            | name              | VARCHAR(30)         | ○       |    |    |        |         |       | 例: Clear車検, 一般整備                                         |
| 有効フラグ            | active            | TINYINT(1) UNSIGNED | ○       |    |    |        | 1       |       | 1:有効, 0:無効                                                  |
| Clear車検予約         | is_clear_shaken   | TINYINT(1) UNSIGNED | ○       |    |    |        | 0       |       | Clear車検用の作業かを識別するフラグ (1:Clear車検)               |
| 表示順                | sort_order        | INT(5) UNSIGNED     | ○       |    |    |        | 0       |       | 並び順を制御するための数値                                      |

**初期データ**

| 作業種別ID   | 作業種別コード      | 作業種別名         | 有効フラグ | Clear車検予約 | 表示順 | 
|--------------|---------------------|--------------------|------------|---------------|--------|
| 1            | clear_shaken        | Clear車検          | 1          | 1             | 10     |
| 2            | general_shaken      | 一般車検           | 1          | 0             | 20     |
| 3            | periodic_inspection | 定期点検           | 1          | 0             | 30     |
| 4            | general_maintenance | 一般整備           | 1          | 0             | 40     |
| 8            | adjustment_clear    | 調整枠 (Clear車検) | 1          | 1             | 80     |
| 9            | other               | その他             | 1          | 0             | 90     |

-----


**3. 店舗マスタ (shops)**

  * **日本語テーブル名:** 店舗マスタ
  * **物理テーブル名:** `shops`
  * **説明:** アプリケーション内で利用する店舗の情報を管理します。
  * **特記事項:** メンテナンス画面は無し

**テーブル構造**

| 論理名 (日本語)       | 物理名 (英語)     | データ型            | NOT NULL | PK | FK | UNIQUE | DEFAULT | INDEX | 備考                                             |
|-----------------------|-------------------|---------------------|----------|----|----|--------|---------|-------|--------------------------------------------------|
| 店舗ID                | id                | TINYINT(3) UNSIGNED | ○       | ○ |    |        |         |       | 主キー                                           |
| 店舗名                | name              | VARCHAR(50)         | ○       |    |    |        |         |       | 例: 本店、モーターショップカミシマ               |
| Clear車検対応         | is_clear_ready    | TINYINT(1) UNSIGNED | ○       |    |    |        | 0       |       | 1:Clear車検対応店                                |
| 有効フラグ            | active            | TINYINT(1) UNSIGNED | ○       |    |    |        | 1       |       | 1:有効, 0:無効                                   |
| 表示順                | sort_order        | INT(5) UNSIGNED     | ○       |    |    |        | 0       |       | 並び順を制御するための数値                       |

**初期データ**

| 店舗ID       | 店舗名                   | Clear車検対応 | 有効フラグ | 表示順 |
|--------------|--------------------------|---------------|------------|--------|
| 1            | 本店                     | 0             | 1          | 10     |
| 2            | モーターショップカミシマ | 0             | 1          | 20     |
| 5            | Clear車検 (本店)         | 1             | 1          | 50     |


-----


**4. 予約時間帯マスタ (time_slots)**

  * **日本語テーブル名:** 予約時間帯マスタ
  * **物理テーブル名:** `time_slots`
  * **説明:** 各店舗で提供される、標準的な予約時間枠を管理します。Clear車検の予約や調整枠の設定などに利用されます。
  * **特記事項:** メンテナンス画面は無し

**テーブル構造**

| 論理名 (日本語)       | 物理名 (英語)     | データ型            | NOT NULL | PK | FK | UNIQUE | DEFAULT | INDEX | 備考                                             |
|-----------------------|-------------------|---------------------|----------|----|----|--------|---------|-------|--------------------------------------------------|
| 予約時間帯ID          | id                | TINYINT(3) UNSIGNED | ○       | ○ |    |        |         |       | 主キー                                           |
| 店舗ID                | shop_id           | TINYINT(3) UNSIGNED | ○       |    | ○ |        |         |       | `shops.id`への外部キー                           |
| 予約時間帯名          | name              | VARCHAR(30)         | ○       |    |    |        |         |       | 例: 8:45～                                       |
| 開始時刻              | start_time        | TIME                | ○       |    |    |        |         |       | 開始時刻 (例: 08:45:00)                          |
| 終了時刻              | end_time          | TIME                | ○       |    |    |        |         |       | 終了時刻 (例: 09:00:00)                          |
| 有効フラグ            | active            | TINYINT(1) UNSIGNED | ○       |    |    |        | 1       |       | 1:有効, 0:無効                                   |
| 表示順                | sort_order        | INT(5) UNSIGNED     | ○       |    |    |        | 0       |       | 並び順を制御するための数値                       |

**初期データ**

| 予約時間帯ID | 店舗ID | 予約時間帯名 | 開始時刻 | 終了時刻 | 有効フラグ | 表示順 |
|--------------|--------|--------------|----------|----------|------------|--------|
| 1            | 5      | 08:45～      | 08:45    | 09:29    | 1          | 10     |
| 2            | 5      | 09:30～      | 09:30    | 10:14    | 1          | 20     |
| 3            | 5      | 10:15～      | 10:15    | 10:59    | 1          | 30     |
| 4            | 5      | 11:00～      | 11:00    | 11:44    | 1          | 40     |
| 5            | 5      | 13:00～      | 13:00    | 13:44    | 1          | 50     |
| 6            | 5      | 13:45～      | 13:45    | 14:29    | 1          | 60     |
| 7            | 5      | 14:30～      | 14:30    | 15:14    | 1          | 70     |
| 8            | 5      | 15:15～      | 15:15    | 15:59    | 1          | 80     |
| 9            | 5      | 16:00～      | 16:00    | 16:44    | 1          | 90     |
| 10           | 5      | 16:45～      | 16:45    | 17:29    | 1          | 100    |

-----


**5. 車両種別マスタ (vehicle_types)**

  * **日本語テーブル名:** 車両種別マスタ
  * **物理テーブル名:** `vehicle_types`
  * **説明:** 車両の種別（乗用車、商用車、貨物車など）を管理します。
  * **特記事項:** メンテナンス画面が必要 (CRUD)

**テーブル構造**

| 論理名 (日本語)       | 物理名 (英語)     | データ型            | NOT NULL | PK | FK | UNIQUE | DEFAULT | INDEX | 備考                                             |
|-----------------------|-------------------|---------------------|----------|----|----|--------|---------|-------|--------------------------------------------------|
| 車両種別ID            | id                | INT UNSIGNED        | ○       | ○ |    |        |         |       | 主キー、自動増分                                 |
| 車両種別コード        | code              | VARCHAR(4)          | ○       |    |    | ○     |         | ○    | 数値4桁のコード                                  |
| 車両種別名            | name              | VARCHAR(30)         | ○       |    |    |        |         |       | 例: 乗用車, 商用車, 貨物車                       |
| 有効フラグ            | active            | TINYINT(1) UNSIGNED | ○       |    |    |        | 1       |       | 1:有効, 0:無効                                   |
| 作成日時              | created_at        | DATETIME            | ○       |    |    |        |         |       | CodeIgniterのタイムスタンプ機能で自動設定        |
| 更新日時              | updated_at        | DATETIME            | ○       |    |    |        |         |       | CodeIgniterのタイムスタンプ機能で自動設定        |
| 削除日時 (論理削除用) | deleted_at        | DATETIME            |          |    |    |        | NULL    |       | CodeIgniterのソフトデリート機能用                |

**初期データ**

| 車両種別ID   | 車両種別コード | 車両種別名        | 有効フラグ |
|--------------|----------------|-------------------|------------|
| 1            | 9999           | その他            | 1          |
| 2            | 0001           | 乗用車            | 1          |
| 3            | 0002           | 商用車            | 1          |
| 4            | 0003           | 貨物車            | 1          |
| 5            | 0004           | 特殊用途車        | 1          |


-----
**6. 予約データ (reservations)**

  * **日本語テーブル名:** 予約データ
  * **物理テーブル名:** `reservations`
  * **説明:** 車検や点検の予約情報を管理するテーブルです。

**テーブル構造**

| 論理名 (日本語)       | 物理名 (英語)          | データ型             | NOT NULL | PK | FK | UNIQUE | DEFAULT | INDEX | 備考                                              |
|-----------------------|------------------------|----------------------|----------|----|----|--------|---------|-------|---------------------------------------------------|
| 予約ID                | id                     | INT UNSIGNED         | ○       | ○ |    |        |         |       | 主キー、自動増分                                  |
| 予約番号              | reservation_no         | VARCHAR(8)           | ○       |    |    | ○     |         |       | 例: 25050001 (YYMMNNNN)                           |
| 予約ステータスID      | reservation_status_id  | TINYINT UNSIGNED     | ○       |    | ○ |        |         |       | `reserve_statuses.id`への外部キー                 |
| 作業種別ID            | work_type_id           | TINYINT UNSIGNED     | ○       |    | ○ |        |         |       | `work_types.id`への外部キー                       |
| 作業店舗ID            | shop_id                | TINYINT UNSIGNED     | ○       |    | ○ |        |         |       | `shops.id`への外部キー                            |
| 予約希望日            | desired_date           | DATE                 | ○       |    |    |        |         | ○    | 例: 2025年2月5日                                  |
| 予約希望時間帯ID      | desired_time_slot_id   | TINYINT UNSIGNED     |          |    | ○ |        | NULL    |       | `time_slots.id`への外部キー。予約時間帯マスタから選択する場合にのみ使用。 |
| 予約開始時刻          | reservation_start_time | TIME                 |          |    |    |        | NULL    |       | 時間範囲で直接入力する場合の開始時刻。(例: 10:00:00)  |
| 予約終了時刻          | reservation_end_time   | TIME                 |          |    |    |        | NULL    |       | 時間範囲で直接入力する場合の終了時刻。(例: 12:00:00)  |
| お客様氏名            | customer_name          | VARCHAR(50)          | ○       |    |    |        |         | ○    | 例: 鈴木 一郎                                     |
| メールアドレス        | email                  | VARCHAR(255)         | ○       |    |    |        |         |       | 例: L.suzuki@sample.com                           |
| LINE識別名            | line_display_name      | VARCHAR(100)         |          |    |    |        | NULL    |       | LINE経由の場合の表示名                            |
| LINE経由フラグ        | via_line               | TINYINT(1) UNSIGNED  | ○       |    |    |        | 0       |       | 1: LINE経由, 0: その他 (デフォルトは0)            |
| 連絡先電話番号        | phone_number1          | VARCHAR(20)          | ○       |    |    |        |         | ○    | 例: 090-XXXX-XXXX                                 |
| 電話番号2             | phone_number2          | VARCHAR(20)          |          |    |    |        | NULL    |       | 例: 0155-XX-XXXX                                  |
| 郵便番号              | postal_code            | VARCHAR(8)           |          |    |    |        | NULL    |       | 例: 080-0803                                      |
| 住所                  | address                | VARCHAR(255)         |          |    |    |        | NULL    |       | 例: 帯広市東３条南８丁目１－１ ＮＫビル           |
| 車両ナンバー(地域)    | vehicle_license_region | VARCHAR(10)          |          |    |    |        | NULL    |       | 例: 帯広                                          |
| 車両ナンバー(分類)    | vehicle_license_class  | VARCHAR(5)           |          |    |    |        | NULL    |       | 例: 330                                           |
| 車両ナンバー(がな)    | vehicle_license_kana   | VARCHAR(5)           |          |    |    |        | NULL    |       | 例: る                                            |
| 車両ナンバー(番号)    | vehicle_license_number | VARCHAR(5)           | ○       |    |    |        |         | ○    | 例: 583                                           |
| 車両タイプID          | vehicle_type_id        | INT UNSIGNED         |          |    | ○ |        | NULL    |       | `vehicle_types.id`への外部キー                    |
| モデル名              | vehicle_model_name     | VARCHAR(50)          |          |    |    |        | NULL    |       | 例: スカイライン                                  |
| 車検満了日            | shaken_expiration_date | DATE                 |          |    |    |        | NULL    |       | 例: 2025年2月20日                                 |
| メモ                  | notes                  | TEXT                 |          |    |    |        | NULL    |       | 車検に関する注意事項等                            |
| 次回点検日            | next_inspection_date   | DATE                 |          |    |    |        | NULL    |       | 今回の作業完了後に設定される、顧客への次回の推奨点検日  |
| 次回点検案内送信      | send_inspection_notice | TINYINT(1) UNSIGNED  | ○       |    |    |        | 0       | ○    | 次回の点検案内を顧客に送信する予定があるかを示すフラグ (1: 送信する, 0: 送信しない) |
| 次回コンタクト予定日  | next_contact_date      | DATE                 |          |    |    |        | NULL    | ○    | 次回フォローアップや連絡を行う予定日              |
| 次回点検案内送信済    | inspection_notice_sent | TINYINT(1) UNSIGNED  | ○       |    |    |        | 0       | ○    | 次回の点検案内が顧客に送信済みであるかを示すフラグ (1: 送信済み, 0: 未送信) |
| 作成日時              | created_at             | DATETIME             | ○       |    |    |        |         |       | CodeIgniterのタイムスタンプ機能で自動設定         |
| 更新日時              | updated_at             | DATETIME             | ○       |    |    |        |         |       | CodeIgniterのタイムスタンプ機能で自動設定         |
| 削除日時 (論理削除用) | deleted_at             | DATETIME             |          |    |    |        | NULL    |       | CodeIgniterのソフトデリート機能用                 |
