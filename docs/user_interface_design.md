# 車検予約管理システム 利用者向け機能 基本設計書

**目的:** 上嶋自動車様の車検予約管理システムにおける、利用者向け機能の基本設計を定義します。

**関連ドキュメント:**

* 基本設計書 (`basic_design.md`)
* データベース仕様書 (`database_specification.md`)

-----

## 1. 利用者向け機能 概要

本システムにおいて、エンドユーザー（お客様）が利用する機能について設計します。
主な機能は以下の通りです。

* **予約状況確認カレンダー:** Clear車検の予約可能な日時をカレンダー形式で確認できます。
* **予約入力フォーム (Clear車検用):** Clear車検の予約をオンラインで行うためのフォームです。
* **予約状況確認ページ:** 予約完了後に発行される専用URLから、自身の予約内容を確認できます。

これらの機能は、原則としてログイン不要で利用可能とします。

-----

## 2. 各機能詳細

### 2.1. 予約状況確認カレンダー

* **機能概要:**
  
  * Clear車検の予約が可能な日時を視覚的に確認できるカレンダーです。
  * 週表示を基本とし、各時間帯の空き状況を表示します。
  * 空いている時間帯を選択すると、予約入力フォームへ遷移する（またはフォーム内の日時が自動入力される）ことを想定します。

* **画面イメージ (ワイヤーフレーム例):**
  
  ```
  +-------------------------------------------------------------------+
  | << 前週  |           202X年X月X日 - 202X年X月X日           |  次週 >> |
  +-------------------------------------------------------------------+
  |         |  月 (X/X)  |  火 (X/X)  |  水 (X/X)  |  木 (X/X)  | ... |
  +---------+------------+------------+------------+------------+-----+
  | 08:45～ | [予約可能] |     ×     | [予約可能] | [予約可能] | ... |
  | 09:30～ |     ×     | [予約可能] |     ×     | [予約可能] | ... |
  | 10:15～ | [予約可能] | [予約可能] | [予約可能] |     ×     | ... |
  |  ...    |    ...     |    ...     |    ...     |    ...     | ... |
  +-------------------------------------------------------------------+
  ※ × は定休日や既に埋まっている時間帯
  ```

* **主要な操作フロー:**
  
  1. 利用者がカレンダーページにアクセスします。
  2. 表示されている週の予約空き状況を確認します。
  3. 「前週」「次週」ボタンで表示する週を切り替えます。
  4. 希望する「予約可能」の時間帯をクリックします。
  5. 予約入力フォームへ遷移し、選択した日時が予約フォームに反映されます。

* **表示項目:**
  
  * 年月、週
  * 曜日、日付
  * 時間帯 (例: `time_slots` マスタに基づく)
  * 各時間帯の予約可否ステータス (例: 予約可能[予約可能], 予約不可[×])

* **補足:**
  
  * スマートフォン表示にも対応したレスポンシブデザインを考慮します。

### 2.2. 予約入力フォーム (Clear車検用)

* **機能概要:**
  * お客様がClear車検の予約を行うための入力フォームです。
  * カレンダーから遷移した場合、選択された日時が自動入力されます。直接アクセスも可能です。
* **画面イメージ (主要項目抜粋):**
  * 作業種別: Clear車検 (固定表示、または非表示で内部的に処理)
  * 作業店舗: (Clear車検対応店舗が複数ある場合は選択、1店舗なら固定表示)
  * 予約希望日時: (カレンダー連携 or 日付・時間ピッカー)
  * お客様情報: 氏名、フリガナ、メールアドレス、電話番号
  * 車両情報: 車両ナンバー、車種名、初年度登録、車検満了日、形式指定番号、類別区分番号
  * ご要望など: (自由記述欄)
* **主要な操作フロー:**
  1. 利用者が予約入力フォームにアクセスします。
  2. 必要な情報を各項目に入力します。
  3. 入力内容を確認し、「予約する」ボタンをクリックします。
  4. 入力内容のバリデーションが行われます。
  5. 問題なければ予約処理が実行され、予約完了ページ（または予約状況確認ページへの案内）へ遷移します。
* **入力項目一覧:** (詳細は `database_specification.md` の `reservations` テーブル定義を参照)
  * 予約希望日 (`desired_date`)
  * 予約希望時間帯 (`desired_time_slot_id` または `reservation_start_time`, `reservation_end_time`)
  * お客様氏名 (`customer_name`)
  * お客様カナ名 (`customer_kana`)
  * メールアドレス (`email`)
  * 連絡先電話番号 (`phone_number1`)
  * 車両ナンバー (各項目)
  * 車両種別ID (`vehicle_type_id`)
  * 車種名 (`vehicle_model_name`)
  * 初年度登録 (first_registration_date)
  * 車検満了日 (`shaken_expiration_date`) - 任意
  * 形式指定番号 (model_spec_number)
  * 類別区分番号 (classification_number)
  * メモ (`notes`) - 任意
* **バリデーションルール (主要なもの):**
  * 必須項目チェック (氏名、電話番号、メールアドレス、予約日時など)
  * メールアドレス形式チェック
  * 電話番号形式チェック (可能な範囲で)
  * 未来の日時であることのチェック

### 2.3. 予約状況確認ページ

* **機能概要:**
  * 予約完了時に発行される一意のURLから、自身の予約内容詳細を確認できるページです。
  * 予約のキャンセルや変更は、このページからは行えず、店舗への連絡を促す形とします（要件による）。
* **画面イメージ:** 予約内容（日時、店舗、お客様情報、車両情報）の一覧表示。
* **主要な操作フロー:**
  1. 利用者が予約完了メールなどに記載された専用URLにアクセスします。
  2. 予約内容が表示されます。
* **表示項目:** `reservations` テーブルに保存された予約情報のうち、顧客に開示して問題ない項目。

-----