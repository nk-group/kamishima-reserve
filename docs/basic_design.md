# 車検予約管理システム 基本設計書

**目的:** 上嶋自動車様の基本設計書です。

### 1. 環境仕様

#### 開発・実行環境
開発の土台となるOSやツールです。

* **OS:** Windows 11 Pro (24H2 推奨) + WSL2/Ubuntu
* **コンテナ:** Docker / Docker Compose
* **エディタ:** VSCode

#### バックエンド
サーバー側で動作するプログラムやデータベースです。

* **PHP:** 8.1.x
* **フレームワーク:** CodeIgniter 4.6.x
* **データベース:** MySQL 5.7.x
* **DB管理ツール:** phpMyAdmin
* **認証ライブラリ:** Shield v1.1.x
* **PDF生成ライブラリ:** mPDF v8.1.x

#### フロントエンド
ブラウザ上で表示・動作する画面側の技術です。

* **ビルドツール:** Vite 5.4.x
* **CSSフレームワーク:** Bootstrap v5.3.x
* **CSSプリプロセッサ:** SASS
* **UIライブラリ:** Flatpickr v4.6.x (カレンダー)

-----

### 2. システム概要

車検、一般整備の予約を管理するシステムです。
公式サイトからはClear車検の予約のみ可能となり、一般整備やその他車検は、スタッフ側の機能からのみ予約できます。
顧客管理や車両の管理は別システムで管理するため、本システムでは予約データのみを管理します。
車検完了時に次回点検日を入力することで、利用者へリマインドメールを自動で送信可能となります。

-----

### 3. 機能概要


| 機能分類            | 機能名                         | 機能概要                                                |
|---------------------|--------------------------------|---------------------------------------------------------|
| 利用者向け機能      | 予約状況確認カレンダー         | 週表示対応のカレンダー  列->日 行→時間帯               |
|                     | 予約入力フォーム(Clear車検用)  | Clear車検専用の予約入力フォーム                         |
|                     | 予約状況確認                   | 予約状況を確認するページ（予約時にランダムのURLを作成） |
| スタッフ向け機能    | ダッシュボード                 | ログイン認証後に表示される画面 (admin,staff用)          |
|                     | 予約状況確認カレンダー         | 予約状況を表示するカレンダー、月表示と週表示が可能      |
|                     | 予約機能 (CRUD)                | スタッフ向けの予約管理機能  Clear車検以外の入力も可能   |
|                     | 入庫予定表印刷 (PDF帳票)       | 指定日付のClear車検用の入庫予定表を印刷                 |
|                     | 予約タグ印刷 (PDF帳票)         | 指定日付の予約タグを印刷  作業種別毎に色分け            |
|                     | 定休日設定                     | 定休日を管理  個別登録と曜日指定で一括登録が可能        |
| 管理者向け機能      | 車両種別マスタ                 | 乗用車、商用車など車両の種別を管理                      |
|                     | ユーザーマスタ                 | 本システムの利用スタッフを登録                          |
|                     | リマインドメール設定           | リマインドメールの送信設定  メールの設定など            |
|                     | データ一括削除                 | 過去の予約を一括で削除                                  |
|                     | 動作環境設定                   | 本システムを利用する為の環境情報を管理                  |
| 自動タスク          | リマインドメール送信           | リマインドメール送信機能  cronから起動                  |


-----

### 3. 認証グループ

* **グループ:** $groups

  | 論理名 (日本語) | 物理名 (英語) | 説明                                                                               |
  |-----------------|---------------|------------------------------------------------------------------------------------|
  | システム管理者  | admin         | サイトの全機能にアクセスでき、システム設定やユーザー管理を行う最上位の権限グループ |
  | 店舗スタッフ    | staff         | 予約の管理、顧客対応など、店舗の日常業務を行うための権限グループ                   |
  | ユーザー        | user          | 車検の予約や自身の予約情報の確認ができる顧客向けの権限グループ                     |


* **パーミッション定義:** $permissions

  | 権限          | 説明                                 |
  |---------------|--------------------------------------|
  | admin.access  | 管理系機能への基本アクセス権限       |
  | staff.access  | スタッフ向け機能への基本アクセス権限 |
  | user.access   | 利用者向け機能への基本アクセス権限'  |



* **パーミッション割り当て:** $matrix

  | グループ | admin.access | staff.access | user.access  |
  |----------|--------------|--------------|--------------|
  | admin    | ○           | ○           | ○           |
  | staff    | ○           | ○           |              |
  | user     | ○           |              |              |



* **機能割り当て:**

  | 機能分類            | 機能名                         | admin | staff | user  |
  |---------------------|--------------------------------|-------|-------|-------|
  | 利用者向け機能(※1) | 予約状況確認カレンダー         | ○    | ○    | ○    |
  |                     | 予約入力フォーム(Clear車検用)  | ○    | ○    | ○    |
  |                     | 予約状況確認                   | ○    | ○    | ○    |
  | スタッフ向け機能    | ダッシュボード                 | ○    | ○    |       |
  |                     | 予約状況確認カレンダー         | ○    | ○    |       |
  |                     | 予約機能 (CRUD)                | ○    | ○    |       |
  |                     | 入庫予定表印刷 (PDF帳票)       | ○    | ○    |       |
  |                     | 予約タグ印刷 (PDF帳票)         | ○    | ○    |       |
  |                     | 定休日設定                     | ○    | ○    |       |
  | 管理者向け機能      | 車両種別マスタ                 | ○    |       |       |
  |                     | ユーザーマスタ                 | ○    |       |       |
  |                     | リマインドメール設定           | ○    |       |       |
  |                     | データ一括削除                 | ○    |       |       |
  |                     | 動作環境設定                   | ○    |       |       |
  | 自動タスク          | リマインドメール送信           | -     | -     | -     |

  ※1：ログイン無しで利用可能
